# TP08 â€“ PostgreSQL: Installation and Basic Operations

## 1. Create Database

```sql
CREATE DATABASE ma_base;
```

---

## 2. Connect to Database

```sql
\c ma_base
```

---

## 3. Create Tables (TP08)

### Table: utilisateurs

```sql
CREATE TABLE utilisateurs (
    id SERIAL PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    date_naissance DATE,
    actif BOOLEAN DEFAULT true,
    date_creation TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Table: commandes

```sql
CREATE TABLE commandes (
    id SERIAL PRIMARY KEY,
    utilisateur_id INTEGER REFERENCES utilisateurs(id),
    montant NUMERIC(10,2),
    date_commande DATE DEFAULT CURRENT_DATE
);
```

---

## 4. Insert Data (INSERT)

```sql
INSERT INTO utilisateurs (nom, email, date_naissance)
VALUES
    ('Alice Dupont', 'alice@email.com', '1990-05-15'),
    ('Bob Martin', 'bob@email.com', '1985-12-20');
```

```sql
INSERT INTO commandes (utilisateur_id, montant)
VALUES (1, 150.75);
```

---

## 5. Reading Data (SELECT)

```sql
SELECT * FROM utilisateurs;
SELECT nom, email FROM utilisateurs;
SELECT * FROM utilisateurs WHERE actif = true;
SELECT * FROM utilisateurs ORDER BY nom ASC;
SELECT * FROM utilisateurs LIMIT 10;
```

---

## 6. Update Data (UPDATE)

```sql
UPDATE utilisateurs
SET actif = false
WHERE date_naissance < '1990-01-01';
```

---

## 7. Delete Data (DELETE)

```sql
DELETE FROM utilisateurs
WHERE actif = false;
```

---

## 8. Joins

### Inner Join

```sql
SELECT u.nom, c.montant, c.date_commande
FROM utilisateurs u
INNER JOIN commandes c ON u.id = c.utilisateur_id;
```

### Left Join with Aggregation

```sql
SELECT u.nom, COUNT(c.id) AS nb_commandes
FROM utilisateurs u
LEFT JOIN commandes c ON u.id = c.utilisateur_id
GROUP BY u.id, u.nom;
```

---

## 9. Aggregations

```sql
SELECT
    COUNT(*) AS total_utilisateurs,
    AVG(EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM date_naissance)) AS age_moyen
FROM utilisateurs;
```

```sql
SELECT
    utilisateur_id,
    COUNT(*) AS nb_commandes,
    SUM(montant) AS total_depense
FROM commandes
GROUP BY utilisateur_id
HAVING SUM(montant) > 100;
```

---

## 10. Indexes

```sql
CREATE INDEX idx_utilisateurs_email ON utilisateurs(email);
CREATE INDEX idx_commandes_date ON commandes(date_commande);
CREATE INDEX idx_utilisateurs_nom_actif ON utilisateurs(nom, actif);
```

---

## 11. Views

```sql
CREATE VIEW vue_utilisateurs_actifs AS
SELECT id, nom, email
FROM utilisateurs
WHERE actif = true;
```
